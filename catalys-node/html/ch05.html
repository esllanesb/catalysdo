
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title xmlns:d="http://docbook.org/ns/docbook">Catalys Node User Guide &#151; Chapter&nbsp;5.&nbsp;Standard Features</title><link rel="stylesheet" type="text/css" href="../resources/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Catalys Node User Guide"><link rel="up" href="index.html" title="Catalys Node User Guide"><link rel="prev" href="ch04s03.html" title="4.3.&nbsp;Configuration Model and Runtime Changes"><link rel="next" href="ch05s02.html" title="5.2.&nbsp;Scheduling"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:d="http://docbook.org/ns/docbook" class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="ch04s03.html">Prev</a>&nbsp;</td><th width="60%" align="center"><div id="navheader_chapter_title">Chapter&nbsp;5.&nbsp;Standard Features</div><div><a accesskey="h" href="index.html">Home</a></div></th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch05s02.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="stdfeature"></a>Chapter&nbsp;5.&nbsp;Standard Features</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="ch05.html#stdfeature_persistence">5.1. Session Persistence</a></span></dt><dd><dl><dt><span class="section"><a href="ch05.html#stdfeature_persistence-intro">5.1.1. Introduction</a></span></dt><dt><span class="section"><a href="ch05.html#stdfeature_persistence-journalingPersister">5.1.2. JournalingPersister</a></span></dt><dt><span class="section"><a href="ch05.html#stdfeature_persistence-MemoryPersister">5.1.3. MemoryPersister</a></span></dt><dt><span class="section"><a href="ch05.html#stdfeature_persistence-MemorySeqNoOnlyPersister">5.1.4. MemorySeqNoOnlyPersister</a></span></dt></dl></dd><dt><span class="section"><a href="ch05s02.html">5.2. Scheduling</a></span></dt><dd><dl><dt><span class="section"><a href="ch05s02.html#stdfeature_scheduling-intro">5.2.1. Introduction</a></span></dt><dt><span class="section"><a href="ch05s02.html#stdfeature_scheduling-config-elements">5.2.2. Configuration Overview</a></span></dt><dt><span class="section"><a href="ch05s02.html#stdfeature_scheduling-config-examples">5.2.3. Configuration Examples</a></span></dt><dt><span class="section"><a href="ch05s02.html#d5e2683">5.2.4. Scheduling and Daylight Savings Time</a></span></dt><dt><span class="section"><a href="ch05s02.html#stdfeature_scheduling-sched-unsched">5.2.5. In Schedule vs. Outside Schedule</a></span></dt><dt><span class="section"><a href="ch05s02.html#stdfeature_scheduling-custom-task">5.2.6. Custom Tasks</a></span></dt><dt><span class="section"><a href="ch05s02.html#stdfeature_scheduling-jmx-management">5.2.7. JMX Management</a></span></dt></dl></dd><dt><span class="section"><a href="ch05s03.html">5.3. FIX Routing</a></span></dt><dd><dl><dt><span class="section"><a href="ch05s03.html#stdfeature_routing-introduction">5.3.1. Introduction</a></span></dt><dt><span class="section"><a href="ch05s03.html#stdfeature_routing-config-options">5.3.2. Routing Modes</a></span></dt><dt><span class="section"><a href="ch05s03.html#stdfeature_routing-methods">5.3.3. Making Routing Decisions</a></span></dt><dt><span class="section"><a href="ch05s03.html#d5e2892">5.3.4. Routing Side</a></span></dt><dt><span class="section"><a href="ch05s03.html#stdfeature_routing-networks">5.3.5. Routing Networks</a></span></dt><dt><span class="section"><a href="ch05s03.html#stdfeature_routing-other-issues">5.3.6. Handling Routing Issues</a></span></dt><dt><span class="section"><a href="ch05s03.html#stdfeature_routing-configuration">5.3.7. FIX Routing Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="ch05s04.html">5.4. FIX Drop Copy</a></span></dt><dd><dl><dt><span class="section"><a href="ch05s04.html#stdfeature_dropcopy-introduction">5.4.1. Introduction</a></span></dt><dt><span class="section"><a href="ch05s04.html#stdfeature_dropcopy-methods">5.4.2. Drop Copy Methods</a></span></dt></dl></dd><dt><span class="section"><a href="ch05s05.html">5.5. Message Buffering</a></span></dt><dd><dl><dt><span class="section"><a href="ch05s05.html#stdfeature_buffering-introduction">5.5.1. Introduction</a></span></dt><dt><span class="section"><a href="ch05s05.html#stdfeature_buffering-configuration">5.5.2. Configuration</a></span></dt><dt><span class="section"><a href="ch05s05.html#d5e3039">5.5.3. Persistent Collection Configuration</a></span></dt><dt><span class="section"><a href="ch05s05.html#stdfeature_buffering-commandline">5.5.4. Managing Buffers from the Command Line</a></span></dt></dl></dd><dt><span class="section"><a href="ch05s06.html">5.6. Message Throttling</a></span></dt><dd><dl><dt><span class="section"><a href="ch05s06.html#stdfeature_throttling-introduction">5.6.1. Introduction</a></span></dt><dt><span class="section"><a href="ch05s06.html#stdfeature_throttling-configuration">5.6.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="ch05s07.html">5.7. FIX Dictionaries</a></span></dt><dd><dl><dt><span class="section"><a href="ch05s07.html#stdfeature_fix_dictionaries-intro">5.7.1. Introduction</a></span></dt><dt><span class="section"><a href="ch05s07.html#stdfeature_fix_dictionaries-gettingstarted">5.7.2. Getting Started</a></span></dt><dt><span class="section"><a href="ch05s07.html#stdfeature_fix_dictionaries-custom">5.7.3. Custom Dictionaries</a></span></dt><dt><span class="section"><a href="ch05s07.html#stdfeature_fix_dictionaries-config">5.7.4. Configuration of Custom Dictionary</a></span></dt><dt><span class="section"><a href="ch05s07.html#stdfeature_fix_dictionaries-api">5.7.5. Dictionaries API</a></span></dt><dt><span class="section"><a href="ch05s07.html#stdfeature_fix_dictionaries-non-xml">5.7.6. Non XML-based Dictionaries</a></span></dt></dl></dd><dt><span class="section"><a href="ch05s08.html">5.8. Inbound Message Validation</a></span></dt><dd><dl><dt><span class="section"><a href="ch05s08.html#stdfeature_message_validation-introduction">5.8.1. Introduction</a></span></dt><dt><span class="section"><a href="ch05s08.html#stdfeature_message_validation-rules">5.8.2. Validation Rules</a></span></dt></dl></dd><dt><span class="section"><a href="ch05s09.html">5.9. Message Factories</a></span></dt><dd><dl><dt><span class="section"><a href="ch05s09.html#stdfeature_message_factory-intro">5.9.1. Introduction</a></span></dt><dt><span class="section"><a href="ch05s09.html#stdfeature_message_factory-configuration">5.9.2. Configuration</a></span></dt><dt><span class="section"><a href="ch05s09.html#stdfeature_message_factory-provided">5.9.3. Provided Implementations</a></span></dt><dt><span class="section"><a href="ch05s09.html#stdfeature_message_factory-custom">5.9.4. Custom Implementation</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="stdfeature_persistence"></a>5.1.&nbsp;Session Persistence</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="stdfeature_persistence-intro"></a>5.1.1.&nbsp;Introduction</h3></div></div></div><p>
      In order to maintain continuity of FIX sessions between application restarts, FIX session state must be
      persisted to disk. If session state is not persisted then the application's in-memory state is lost after
      a restart, and manual intervention is required at the counterparty to reestablish the session.
    </p><p>
      The FIX session state consists of the following elements, which are stored in separate directories on
      the filesystem. The name of each directory is suffixed with an identifier, which is indicated below
      in parentheses.
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
        All outbound messages sent on the session and the next outbound sequence number
        (<span class="emphasis"><em>-outMsg</em></span>)
      </li><li class="listitem">
        The next inbound sequence number expected (<span class="emphasis"><em>-inSeqNum</em></span>)
      </li><li class="listitem">
        Session attributes: the last reset time, session state and the logged-on status
        (<span class="emphasis"><em>-atts</em></span>)
      </li><li class="listitem">
        Optional: All inbound messages received on the session (<span class="emphasis"><em>-inMsg</em></span>)
      </li></ul></div><p>
      Persisters are configured within each <a class="code" href="ch03.html#config_basic-session" title="3.1.3.&nbsp;Session Configuration">Session</a>
      element in the Node's configuration. Classes which implement the
      <a class="javadoc" href="../javadoc/com/camerontec/catalys/core/session/persistence/IFIXSessionStatePersister.html" target="_top">IFIXSessionStatePersister</a>
      interface can be configured as persisters.
    </p><div class="note"><h3 class="title">Note</h3><p>
        The <code class="code">JournalingPersister</code> is the default file-based persister provided with the Node. This persister
        should be used in all production environments. Memory-based persisters should only be used under unique
        circumstances.
      </p></div><p>
      Two memory-based implementations,
      <a class="javadoc" href="../javadoc/com/camerontec/catalys/core/session/persistence/MemoryPersister.html" target="_top">MemoryPersister</a>
      and
      <a class="javadoc" href="../javadoc/com/camerontec/catalys/core/session/persistence/MemorySeqNoOnlyPersister.html" target="_top">MemorySeqNoOnlyPersister</a>,
      are provided for test purposes only. Note that <code class="code">MemorySeqNoOnlyPersister</code> will be chosen as the
      default persister if no other persister has been configured.
    </p><p>
      For a demonstration of the <code class="code">JournalingPersister</code>, please see the template in
      <span class="emphasis"><em>templates/FilePersistence</em></span>.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="stdfeature_persistence-journalingPersister"></a>5.1.2.&nbsp;JournalingPersister</h3></div></div></div><p>
      The <code class="code">JournalingPersister</code> stores each FIX session state element in a directory based on the
      <code class="code">baseDirectoryName</code> attribute.
    </p><p>
      If you use the installer and select the 'Node Instances' option, persistence data will be created in the
      <span class="emphasis"><em>&lt;CATALYS_NODE_INSTANCES&gt;/example/data</em></span> directory.
    </p><div class="important"><h3 class="title">Important</h3><p>
        The <code class="code">baseDirectoryName</code> attribute is treated as a directory name prefix. Suffixes for each data type
        are added automatically. For example, if the attribute's value is <code class="code">/data/CLIENT1</code>, the effective
        directory names will be:

        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">/data/CLIENT1-outMsg/</li><li class="listitem">/data/CLIENT1-inSeqNum/</li><li class="listitem">/data/CLIENT1-atts/</li></ul></div><p>

        </p><p>
          Therefore the value of this attribute must not end with a backslash.
        </p><p>
      </p></div><p>
      By default, the message elements (<span class="emphasis"><em>outMsg</em></span> and <span class="emphasis"><em>inMsg</em></span>) are stored in a
      high-capacity indexed list. Two files will be created for each element: journal files
      (<span class="emphasis"><em>journal.*.dat</em></span>) and index files (<span class="emphasis"><em>index.dat</em></span>).
    </p><p>
      If the <code class="code">JournalingPersister</code> is configured for a session that is part of a High Availability
      environment, then its persistence data will automatically be replicated across the cluster.
    </p><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="stdfeature_persistence-configuration"></a>Configuration</h4></div></div></div><p>The minimum configuration for the <code class="code">JournalingPersister</code> is as follows:</p><pre class="programlisting">&lt;Persister&gt;
  &lt;JournalingPersister id="jp1" baseDirectoryName="../data/persist/CLIENT1" /&gt;
&lt;/Persister&gt;</pre><p>
        For a complete list of attributes, see the
        <a href="config_reference.html#config_ref_JournalingPersister" title="JournalingPersister">JournalingPersister Configuration Reference</a>.
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="d5e2436"></a>Persistent Collections Properties</h4></div></div></div><p>
        The underlying persistence store of the <code class="code">JournalingPersister</code> is configured using
        <a href="apd.html" title="Appendix&nbsp;D.&nbsp;Persistent Collections Properties">Persistent Collection Properties</a>, which are specified
        via a nested <code class="code">Properties</code> element.
      </p><p>
        As described above, the <code class="code">JournalingPersister</code> creates a different directory for output messages,
        input sequence number, state attributes and (if <code class="code">persistInputMessages</code> is set to true) input
        messages. Each directory generated by the <code class="code">JournalingPersister</code> is backed by a different collection,
        and as such has its own set of collection properties. There is however only one set of properties for the
        <code class="code">JournalingPersister</code>, passed in via a nested <code class="code">Properties</code> element.
      </p><p>
        The name of each property can be prefixed by a specific element type (e.g. <code class="code">outMsg-</code>,
        <code class="code">atts-</code>, <code class="code">inSeqNum-</code>, <code class="code">inMsg-</code>) which applies only to that collection, or the
        property can be supplied in its generic form (without prefixes) which applies to all collections.
      </p><p>
        For example, to set the
        <a class="code" href="apds02.html#persistent_collections_properties-filePathLevelsInLogger">filePathLevelsInLogger</a>
        attribute for all persistence files:
      </p><pre class="programlisting">&lt;Persister&gt;
  &lt;JournalingPersister id="jp1" baseDirectoryName="../data/persist/CLIENT1"&gt;
    &lt;Properties id="jp1-props"&gt;
      &lt;Property name="filePathLevelsInLogger" value="3"/&gt;
    &lt;/Properties&gt;
  &lt;/JournalingPersister&gt;
&lt;/Persister&gt;</pre><p>
        To set the
        <a class="code" href="apds02.html#persistent_collections_properties-rollJournalFileEvery">rollJournalFileEvery</a>
        attribute to a different value for each file, the configuration would be:
      </p><pre class="programlisting">&lt;Persister&gt;
  &lt;JournalingPersister id="jp1" baseDirectoryName="../data/persist/CLIENT1"&gt;
    &lt;Properties id="jp1-props"&gt;
      &lt;Property name="outMsg-rollJournalFileEvery" value="1073741824"/&gt;
      &lt;Property name="atts-rollJournalFileEvery" value="1024"/&gt;
      &lt;Property name="inSeqNum-rollJournalFileEvery" value="2048"/&gt;
    &lt;/Properties&gt;
  &lt;/JournalingPersister&gt;
&lt;/Persister&gt;</pre><p>
        There are some default attributes for the <code class="code">JournalingPersister</code> that are different from the standard
        Persistent Collections defaults:
      </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>Attribute</th><th>Default</th></tr></thead><tbody><tr><td><a href="apds02.html#persistent_collections_properties-directoryName">directoryName</a></td><td>
                This attribute is ignored. The <code class="code">baseDirectoryName</code> of the <code class="code">JournalingPersister</code>
                element is used instead.
              </td></tr><tr><td><a href="apds02.html#persistent_collections_properties-name">name</a></td><td>
                Defaults to <code class="code">baseDirectoryName</code> + element type (e.g. <code class="code">-outMsg</code>). If this
                attribute is supplied, then it should not be used in its generic form, rather it must be explicitly
                prefixed by the file descriptor. For example:
                <pre class="programlisting">&lt;Persister&gt;
  &lt;JournalingPersister
    id="jp1"
    baseDirectoryName="../data/persist/CLIENT1"&gt;

    &lt;Properties id="jp1-props"&gt;
      &lt;Property name="outMsg-name" value="outMsg"/&gt;
      &lt;Property name="atts-name" value="atts"/&gt;
      &lt;Property name="inSeqNum-name" value="inSeqNum"/&gt;
    &lt;/Properties&gt;
  &lt;/JournalingPersister&gt;
&lt;/Persister&gt;</pre>
              </td></tr><tr><td><a href="apds02.html#persistent_collections_properties-highCapacityList">isHighCapacityList</a></td><td>
                Defaults to <code class="code">true</code> for the <span class="emphasis"><em>outMsg</em></span> and <span class="emphasis"><em>inMsg</em></span>
                collections, and defaults to <code class="code">false</code> for the <span class="emphasis"><em>inSeqNum</em></span> and
                <span class="emphasis"><em>atts</em></span> collections.
              </td></tr><tr><td><a href="apds02.html#persistent_collections_properties-versionHistorySize">versionHistorySize</a></td><td>
                Defaults to <code class="code">100,000</code> instead of <code class="code">10,000</code> for the <span class="emphasis"><em>outMsg</em></span> and
                <span class="emphasis"><em>inMsg</em></span> collections.
              </td></tr></tbody></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="stdfeature_persistence-maintenance"></a>Maintenance</h4></div></div></div><p>
        To ensure that the persistence files do not grow without bound, the files associated with the
        <code class="code">JournalingPersister</code> need to be compacted periodically. This is performed automatically by the
        Node when a <a href="ch04.html#operations_lifecycle-resetting-sessions" title="4.1.5.&nbsp;Resetting FIX Sessions">session reset</a> occurs.
      </p><p>
        Alternatively the <code class="code">CompactTask</code> can be <a href="ch05s02.html" title="5.2.&nbsp;Scheduling">scheduled</a>. This
        task takes a colon-delimited set of names as a property. These names identify the collections to compact. In
        the case of the <code class="code">JournalingPersister</code>, there is one name for each type of collection for each
        session: -outMsg, -atts, -inSeqNum (and optionally -inMsg), and these names are prefixed by the value of
        <code class="code">baseCollectionName</code> if it is specified, or <code class="code">baseDirectoryName</code> if it is not. For example
        (in the case where <code class="code">baseCollectionName</code> is not specified and <code class="code">baseDirectoryName</code> is set
        to <code class="code">persist/Session1</code>):
      </p><pre class="programlisting">&lt;Task id="compact" class="com.camerontec.catalys.server.task.CompactTask"&gt;
  &lt;Properties id="props1"&gt;
    &lt;Property name="names" value="persist/Session1-outMsg:persist/Session1-atts"/&gt;
  &lt;/Properties&gt;
&lt;/Task&gt;</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="stdfeature_persistence-MemoryPersister"></a>5.1.3.&nbsp;MemoryPersister</h3></div></div></div><p>
      The <code class="code">MemoryPersister</code> should only be used for testing purposes and never in a production environment.
      It stores each FIX session state element in memory, which will be lost if the Node is restarted.
    </p><div class="caution"><h3 class="title">Caution</h3><p>
        If the <code class="code">MemoryPersister</code> runs indefinitely, it will consume all of the JVM's allotted memory and
        cause the Node to crash.
      </p></div><p>
      The configuration for the <code class="code">MemoryPersister</code> is as follows:</p><pre class="programlisting">&lt;Persister&gt;
  &lt;MemoryPersister id="mp1" /&gt;
&lt;/Persister&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="stdfeature_persistence-MemorySeqNoOnlyPersister"></a>5.1.4.&nbsp;MemorySeqNoOnlyPersister</h3></div></div></div><p>
      The <code class="code">MemorySeqNoOnlyPersister</code> should only be used for testing purposes and never in a production
      environment. It only stores inbound and outbound sequence number in memory, which will be lost if the Node is
      restarted. This is the default session persister if no other persister is configured.
     </p></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s03.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch05s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.3.&nbsp;Configuration Model and Runtime Changes&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;5.2.&nbsp;Scheduling</td></tr></table></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:date="http://exslt.org/dates-and-times" id="footer_copyright"><div id="footer_copyright_pubdate">Published 2024-02-22T15:52:35+01:00</div><div id="footer_copyright_copy">
        Copyright &copy; 2024 CameronTec</div></div></body></html>